<!DOCTYPE html>
<html>
<head>
  <title>災害用アプリ</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= stylesheet_link_tag 'styles', media: 'all', 'data-turbolinks-track': 'reload' %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
</head>
<body>
  <!-- ヘッダーの部分テンプレートを読み込み -->
  <%= render 'layouts/header' %>

  <!-- 各ページごとのコンテンツをここに表示 -->
  <main>
    <%= yield %>
  </main>

  <!-- フッターの部分テンプレートを読み込み -->
  <%= render 'layouts/footer' %>

  <script type="module">
    document.addEventListener('DOMContentLoaded', function() {
      const csvFilePath = '<%= asset_path('shelters.csv') %>'; // 正しいCSVファイルのパスを指定

      fetch(csvFilePath)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.text();
        })
        .then(data => {
          const shelters = parseCSV(data);
          console.log(shelters); // 読み込んだデータをコンソールに表示
          // ここでGPS機能の実装などを行う
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        });

      function parseCSV(data) {
        const rows = data.split('\n');
        const shelters = rows.slice(1).map(row => {
          const columns = row.split(',');
          return {
            municipality_code: columns[0],
            facility_name: columns[1],
            address: columns[2],
            latitude: columns[3],
            longitude: columns[4]
          };
        });
        return shelters;
      }
    });
  </script>
</body>
</html>