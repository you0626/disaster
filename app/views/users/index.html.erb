<main>
  <section class="emergency-notification">
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            fetch('/users/update_location', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': '<%= form_authenticity_token %>'
              },
              body: JSON.stringify({
                latitude: position.coords.latitude,
                longitude: position.coords.longitude
              })
            });
          });
        } else {
          alert("現在位置情報を取得できませんでした。");
        }
      });
    </script>
    
    <!-- 常にタイトルを表示 -->
    <section class="disaster-notifications">
      <h2>周辺エリアの災害通知</h2>

      <!-- 通知がある場合にリストを表示、なければメッセージを表示 -->
      <% if @nearby_notifications.present? %>
        <ul>
          <% @nearby_notifications.each do |notification| %>
            <li>
              <strong>災害名:</strong> <%= notification.title %><br>
              <strong>発生日時:</strong> <%= notification.occurred_at.strftime("%Y年%m月%d日 %H:%M") %><br>
              <strong>詳細:</strong> <%= notification.details %><br>
              <strong>場所:</strong> <%= notification.location %>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p>周辺エリアに災害通知はありません。</p>
      <% end %>
    </section>
  </section>

  <!-- 以下は元のコードのまま -->
  <section class="search-shelter">
    <h2>避難所検索</h2>
    <%= form_with url: '#', method: :get, local: true do %>
      <%= text_field_tag :search, nil, placeholder: '現在地からの検索...' %>
      <%= submit_tag '検索' %>
    <% end %>
  </section>

  <% if user_signed_in? %>
    <section class="checklist">
      <h2>必要な物のチェックリスト</h2>
      <ul>
        <li><%= check_box_tag 'water' %> 水</li>
        <li><%= check_box_tag 'food' %> 食料</li>
        <li><%= check_box_tag 'medical' %> 医療品</li>
      </ul>
    </section>

    <section class="reminders">
      <h2>備蓄品のリマインダー</h2>
      <ul>
        <li>水 (賞味期限: 2024年1月1日)</li>
        <li>非常食 (賞味期限: 2023年12月31日)</li>
      </ul>
    </section>

    <section class="user-activity">
      <h2>最近のアクティビティ</h2>
      <p>最後のログイン: <%= current_user.last_login_at.strftime("%Y年%m月%d日 %H:%M") if current_user.last_login_at %></p>
    </section>
  <% end %>

  <section class="manual">
    <h2>災害マニュアル</h2>
    <%= link_to '地震マニュアル', '#' %><br>
    <%= link_to '台風マニュアル', '#' %>
  </section>
</main>